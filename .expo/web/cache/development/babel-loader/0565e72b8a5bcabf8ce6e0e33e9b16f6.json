{"ast":null,"code":"import _defineProperty from \"@babel/runtime/helpers/defineProperty\";\nimport _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) { symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); } keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport React, { useRef, useState, useEffect } from 'react';\nimport View from \"react-native-web/dist/exports/View\";\nimport StyleSheet from \"react-native-web/dist/exports/StyleSheet\";\nimport Text from \"react-native-web/dist/exports/Text\";\nimport Animated from \"react-native-web/dist/exports/Animated\";\nimport PanResponder from \"react-native-web/dist/exports/PanResponder\";\nimport Dimensions from \"react-native-web/dist/exports/Dimensions\";\nimport LayoutAnimation from \"react-native-web/dist/exports/LayoutAnimation\";\nimport UIManager from \"react-native-web/dist/exports/UIManager\";\nimport Platform from \"react-native-web/dist/exports/Platform\";\nimport { Card, Button } from 'react-native-elements';\nimport { doc, setDoc, getDoc, getDocs, updateDoc, collection } from 'firebase/firestore';\nimport { auth, firestore, storage } from \"../../firebase\";\nimport { LoadingScreen } from \"./LoadingScreen\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nvar SCREEN_WIDTH = Dimensions.get('window').width;\nvar SCREEN_HEIGHT = Dimensions.get('window').height;\nvar SWIPE_THRESHOLD = 0.25 * SCREEN_WIDTH;\nvar SWIPE_OUT_DURATION = 250;\nvar IMAGE_HEIGHT = SCREEN_HEIGHT / 2;\n\nvar Deck = function Deck(_ref) {\n  var data = _ref.data;\n  UIManager.setLayoutAnimationEnabledExperimental && UIManager.setLayoutAnimationEnabledExperimental(true);\n  LayoutAnimation.spring();\n  var position = useRef(new Animated.ValueXY()).current;\n  var panResponder = useRef(PanResponder.create({\n    onStartShouldSetPanResponder: function onStartShouldSetPanResponder() {\n      return true;\n    },\n    onPanResponderMove: function onPanResponderMove(event, gesture) {\n      position.setValue({\n        x: gesture.dx,\n        y: gesture.dy\n      });\n    },\n    onPanResponderRelease: function onPanResponderRelease(event, gesture) {\n      if (gesture.dx > SWIPE_THRESHOLD) {\n        forceSwipe('right');\n      } else if (gesture.dx < -SWIPE_THRESHOLD) {\n        forceSwipe('left');\n      } else {\n        resetPosition();\n      }\n    }\n  })).current;\n\n  var forceSwipe = function forceSwipe(direction) {\n    var x = direction === 'right' ? SCREEN_WIDTH : -SCREEN_WIDTH;\n    Animated.timing(position, {\n      toValue: {\n        x: x,\n        y: 0\n      },\n      duration: SWIPE_OUT_DURATION,\n      useNativeDriver: false\n    }).start(function () {\n      return onSwipeComplete(direction);\n    });\n  };\n\n  var _useState = useState(0),\n      _useState2 = _slicedToArray(_useState, 2),\n      index = _useState2[0],\n      setIndex = _useState2[1];\n\n  var onSwipeComplete = function onSwipeComplete(direction) {\n    var item = data[index];\n    direction === 'right' ? onSwipeRight() : onSwipeLeft();\n    position.setValue({\n      x: 0,\n      y: 0\n    });\n    setIndex(function (prevIndex) {\n      return prevIndex + 1;\n    });\n  };\n\n  var resetPosition = function resetPosition() {\n    Animated.spring(position, {\n      toValue: {\n        x: 0,\n        y: 0\n      },\n      useNativeDriver: false\n    }).start();\n  };\n\n  var rotate = position.x.interpolate({\n    inputRange: [-SCREEN_WIDTH * 1.5, 0, SCREEN_WIDTH * 1.5],\n    outputRange: ['-120deg', '0deg', '120deg']\n  });\n\n  var onSwipeRight = function onSwipeRight() {\n    var item = data[index];\n    console.log(\"like \" + item.uid);\n    var requestRef = doc(firestore, \"request/\" + item.uid);\n    setDoc(requestRef, _defineProperty({}, auth.currentUser.uid, true), {\n      capital: true\n    }, {\n      merge: true\n    });\n  };\n\n  var onSwipeLeft = function onSwipeLeft() {\n    console.log(\"dislike\");\n  };\n\n  return _jsxs(_Fragment, {\n    children: [index >= data.length && _jsx(RenderNoMoreCards, {}), data.map(function (item, i) {\n      if (i < index) {\n        return null;\n      }\n\n      if (i === index) {\n        return _jsx(Animated.View, _objectSpread(_objectSpread({\n          style: [_objectSpread(_objectSpread({}, position.getLayout()), {}, {\n            transform: [{\n              rotate: rotate\n            }],\n            zIndex: 1,\n            elevation: Platform.OS === 'android' ? 50 : 0\n          }), styles.cardStyle]\n        }, panResponder.panHandlers), {}, {\n          children: _jsx(RenderCards, {\n            item: item\n          })\n        }), item.uid);\n      }\n\n      return _jsx(Animated.View, {\n        style: [styles.cardStyle, {\n          top: 10 * (i - index)\n        }],\n        children: _jsx(RenderCards, {\n          item: item\n        })\n      }, item.uid);\n    }).reverse()]\n  });\n};\n\nvar RenderCards = function RenderCards(_ref2) {\n  var item = _ref2.item;\n  return _jsxs(Card, {\n    children: [_jsx(Card.Title, {\n      style: styles.titleStyle,\n      children: item.name\n    }), _jsx(Card.Divider, {}), item.uri ? _jsx(Card.Image, {\n      source: {\n        uri: item.uri\n      },\n      style: styles.imageStyle,\n      resizeMode: \"contain\"\n    }) : _jsx(Card.Image, {\n      source: require(\"../../assets/defaultUserIcon.png\"),\n      style: styles.imageStyle,\n      resizeMode: \"stretch\"\n    }), _jsx(Card.Divider, {}), _jsx(Text, {\n      style: styles.textStyle,\n      children: item.introduction\n    }), _jsx(Button, {\n      buttonStyle: styles.buttonStyle,\n      title: \"\\u30D7\\u30ED\\u30D5\\u30A3\\u30FC\\u30EB\\u306F\\u3053\\u3061\\u3089\",\n      onPress: function onPress() {\n        console.info(\"name: \" + item.name);\n      }\n    })]\n  }, item.uid);\n};\n\nvar RenderNoMoreCards = function RenderNoMoreCards() {\n  return _jsxs(Card, {\n    style: styles.cardStyle,\n    children: [_jsx(Card.Title, {\n      style: styles.titleStyle,\n      children: \"\\u7D42\\u4E86\"\n    }), _jsx(Card.Divider, {}), _jsx(Text, {\n      style: styles.textStyle,\n      children: \"aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa\"\n    }), _jsx(Button, {\n      buttonStyle: styles.buttonStyle,\n      title: \"\\u3082\\u3046\\u4E00\\u5EA6\",\n      onPress: function onPress() {}\n    })]\n  });\n};\n\nvar SwipeScreen = function SwipeScreen() {\n  var _useState3 = useState([]),\n      _useState4 = _slicedToArray(_useState3, 2),\n      data = _useState4[0],\n      setData = _useState4[1];\n\n  var _useState5 = useState(true),\n      _useState6 = _slicedToArray(_useState5, 2),\n      loading = _useState6[0],\n      setLoading = _useState6[1];\n\n  useEffect(function _callee2() {\n    var usersRef, usersSnap, users;\n    return _regeneratorRuntime.async(function _callee2$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            usersRef = collection(firestore, \"users/\");\n            _context2.next = 3;\n            return _regeneratorRuntime.awrap(getDocs(usersRef));\n\n          case 3:\n            usersSnap = _context2.sent;\n            users = [];\n            usersSnap.docs.forEach(function _callee(doc) {\n              return _regeneratorRuntime.async(function _callee$(_context) {\n                while (1) {\n                  switch (_context.prev = _context.next) {\n                    case 0:\n                      if (doc.data().uid != auth.currentUser.uid) {\n                        users.push(_objectSpread(_objectSpread({}, doc.data()), {}, {\n                          uri: doc.data().imgURL == '' ? null : doc.data().imgURL\n                        }));\n                      }\n\n                    case 1:\n                    case \"end\":\n                      return _context.stop();\n                  }\n                }\n              }, null, null, null, Promise);\n            });\n            setData(users);\n            setLoading(false);\n\n          case 8:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, null, null, null, Promise);\n  }, []);\n\n  if (loading) {\n    return _jsx(LoadingScreen, {});\n  }\n\n  return _jsx(View, {\n    style: styles.container,\n    children: _jsx(Deck, {\n      data: data\n    })\n  });\n};\n\nvar styles = StyleSheet.create({\n  container: {\n    flex: 1,\n    marginTop: 40,\n    backgroundColor: '#fff',\n    alignItems: 'center'\n  },\n  cardStyle: {\n    marginTop: \"10%\",\n    position: 'absolute',\n    width: SCREEN_WIDTH,\n    borderRadius: 50\n  },\n  imageStyle: {\n    height: IMAGE_HEIGHT,\n    width: SCREEN_WIDTH\n  },\n  titleStyle: {\n    fontSize: 18\n  },\n  textStyle: {\n    marginBottom: 10,\n    fontSize: 16\n  },\n  buttonStyle: {\n    borderRadius: 50,\n    marginLeft: 0,\n    marginRight: 0,\n    marginBottom: 0\n  }\n});\nexport { SwipeScreen };","map":{"version":3,"sources":["C:/Users/yumej/github/nikoichi/src/screens/SwipeScreen.js"],"names":["React","useRef","useState","useEffect","Card","Button","doc","setDoc","getDoc","getDocs","updateDoc","collection","auth","firestore","storage","LoadingScreen","SCREEN_WIDTH","Dimensions","get","width","SCREEN_HEIGHT","height","SWIPE_THRESHOLD","SWIPE_OUT_DURATION","IMAGE_HEIGHT","Deck","data","UIManager","setLayoutAnimationEnabledExperimental","LayoutAnimation","spring","position","Animated","ValueXY","current","panResponder","PanResponder","create","onStartShouldSetPanResponder","onPanResponderMove","event","gesture","setValue","x","dx","y","dy","onPanResponderRelease","forceSwipe","resetPosition","direction","timing","toValue","duration","useNativeDriver","start","onSwipeComplete","index","setIndex","item","onSwipeRight","onSwipeLeft","prevIndex","rotate","interpolate","inputRange","outputRange","console","log","uid","requestRef","currentUser","capital","merge","length","map","i","getLayout","transform","zIndex","elevation","Platform","OS","styles","cardStyle","panHandlers","top","reverse","RenderCards","titleStyle","name","uri","imageStyle","require","textStyle","introduction","buttonStyle","info","RenderNoMoreCards","SwipeScreen","setData","loading","setLoading","usersRef","usersSnap","users","docs","forEach","push","imgURL","container","StyleSheet","flex","marginTop","backgroundColor","alignItems","borderRadius","fontSize","marginBottom","marginLeft","marginRight"],"mappings":"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","sourcesContent":["//import Deck from '../components/SwipeCard';\r\nimport React, { useRef, useState, useEffect } from 'react';\r\nimport {\r\n  View,\r\n  StyleSheet,\r\n  Text,\r\n  Animated,\r\n  PanResponder,\r\n  Dimensions,\r\n  LayoutAnimation,\r\n  UIManager,\r\n  Platform,\r\n} from 'react-native';\r\nimport { Card, Button } from 'react-native-elements';\r\nimport { doc, setDoc, getDoc, getDocs, updateDoc, collection } from 'firebase/firestore';\r\n\r\nimport { auth, firestore, storage } from '../../firebase';\r\nimport { LoadingScreen } from './LoadingScreen';\r\n\r\nconst SCREEN_WIDTH = Dimensions.get('window').width;\r\nconst SCREEN_HEIGHT = Dimensions.get('window').height;\r\nconst SWIPE_THRESHOLD = 0.25 * SCREEN_WIDTH;\r\nconst SWIPE_OUT_DURATION = 250;\r\nconst IMAGE_HEIGHT = SCREEN_HEIGHT / 2;\r\n\r\nconst Deck = ({ data }) => {\r\n  UIManager.setLayoutAnimationEnabledExperimental &&\r\n    UIManager.setLayoutAnimationEnabledExperimental(true);\r\n  LayoutAnimation.spring();\r\n\r\n  const position = useRef(new Animated.ValueXY()).current;\r\n  const panResponder = useRef(\r\n    PanResponder.create({\r\n      onStartShouldSetPanResponder: () => true,\r\n      onPanResponderMove: (event, gesture) => {\r\n        position.setValue({ x: gesture.dx, y: gesture.dy });\r\n      },\r\n      onPanResponderRelease: (event, gesture) => {\r\n        if (gesture.dx > SWIPE_THRESHOLD) {\r\n          forceSwipe('right');\r\n        } else if (gesture.dx < -SWIPE_THRESHOLD) {\r\n          forceSwipe('left');\r\n        } else {\r\n          resetPosition();\r\n        }\r\n      },\r\n    })\r\n  ).current;\r\n\r\n  const forceSwipe = (direction) => {\r\n    const x = direction === 'right' ? SCREEN_WIDTH : -SCREEN_WIDTH;\r\n    Animated.timing(position, {\r\n      toValue: { x, y: 0 },\r\n      duration: SWIPE_OUT_DURATION,\r\n      useNativeDriver: false,\r\n    }).start(() => onSwipeComplete(direction));\r\n  };\r\n  \r\n  const [index, setIndex] = useState(0);\r\n\r\n  const onSwipeComplete = (direction) => {\r\n    const item = data[index];\r\n\r\n    direction === 'right' ? onSwipeRight() : onSwipeLeft();\r\n    position.setValue({ x: 0, y: 0 });\r\n    setIndex(prevIndex => prevIndex + 1);\r\n  };\r\n\r\n  const resetPosition = () => {\r\n    Animated.spring(position, {\r\n      toValue: { x: 0, y: 0 },\r\n      useNativeDriver: false,\r\n    }).start();\r\n  };\r\n\r\n  const rotate = position.x.interpolate({\r\n    inputRange: [-SCREEN_WIDTH * 1.5, 0, SCREEN_WIDTH * 1.5],\r\n    outputRange: ['-120deg', '0deg', '120deg'],\r\n  });\r\n\r\n  const onSwipeRight = () => {\r\n    const item = data[index];\r\n    console.log(\"like \" + item.uid);\r\n    const requestRef = doc(firestore, `request/${item.uid}`);\r\n    setDoc(requestRef, {\r\n      [auth.currentUser.uid] : true,\r\n    },{ capital: true }, { merge: true });\r\n  };\r\n\r\n  const onSwipeLeft = () => {\r\n    console.log(\"dislike\");\r\n    // 嫌いの時\r\n  };\r\n\r\n  return (\r\n    <>\r\n      {index >= data.length && <RenderNoMoreCards />}\r\n      {data\r\n        .map((item, i) => {\r\n          if (i < index) {\r\n            return null;\r\n          }\r\n\r\n          if (i === index) {\r\n            return (\r\n              <Animated.View\r\n                key={item.uid}\r\n                style={[\r\n                  {\r\n                    ...position.getLayout(),\r\n                    transform: [{ rotate }],\r\n                    zIndex: 1,\r\n                    elevation: (Platform.OS === 'android') ? 50 : 0\r\n                  },\r\n                  styles.cardStyle,\r\n                ]}\r\n                {...panResponder.panHandlers}\r\n              >\r\n                <RenderCards item={item} />\r\n              </Animated.View>\r\n            );\r\n          }\r\n\r\n          return (\r\n            <Animated.View\r\n              key={item.uid}\r\n              style={[styles.cardStyle, { top: 10 * (i - index) }]}\r\n            >\r\n              <RenderCards item={item} />\r\n            </Animated.View>\r\n          );\r\n        })\r\n        .reverse()}\r\n    </>\r\n  );\r\n};\r\n\r\nconst RenderCards = ({ item }) => {\r\n  return (\r\n    <Card key={item.uid}>\r\n      <Card.Title style={styles.titleStyle}>{item.name}</Card.Title>\r\n      <Card.Divider />\r\n        {\r\n          item.uri ? \r\n            <Card.Image source={{ uri: item.uri }} style={styles.imageStyle} resizeMode='contain'/> :\r\n            <Card.Image source={require('../../assets/defaultUserIcon.png')} style={styles.imageStyle} resizeMode='stretch'/>\r\n        }\r\n      <Card.Divider />\r\n      <Text style={styles.textStyle}>{item.introduction}</Text>\r\n      <Button buttonStyle={styles.buttonStyle} title=\"プロフィールはこちら\" onPress={() => {console.info(`name: ${item.name}`)}} />\r\n    </Card>\r\n  );\r\n};\r\n\r\nconst RenderNoMoreCards = () => {\r\n  return (\r\n    <Card style={styles.cardStyle}>\r\n      <Card.Title style={styles.titleStyle}>終了</Card.Title>\r\n      <Card.Divider />\r\n      <Text style={styles.textStyle}>aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa</Text>\r\n      <Button buttonStyle={styles.buttonStyle} title=\"もう一度\" onPress={() => {}}/>\r\n    </Card>\r\n  );\r\n};\r\n\r\nconst SwipeScreen = () => {\r\n\r\n  const [data, setData] = useState([]);\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  useEffect(async () => {\r\n    // iconが更新されるごとにアイコンを取得\r\n    const usersRef = collection(firestore, `users/`);\r\n    const usersSnap = await getDocs(usersRef);\r\n\r\n    let users = [];\r\n    usersSnap.docs.forEach(async (doc) => {\r\n      if(doc.data().uid != auth.currentUser.uid){\r\n        users.push(\r\n          {\r\n            ...doc.data(),\r\n            uri : doc.data().imgURL == '' ? null : doc.data().imgURL,\r\n          }\r\n        );\r\n      }\r\n    });\r\n    setData(users);\r\n    setLoading(false);\r\n  },[]);\r\n\r\n  if(loading){\r\n    return <LoadingScreen />;\r\n  }\r\n\r\n  return (\r\n    <View style={styles.container}>\r\n      <Deck data={data} />\r\n    </View>\r\n  );\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n    container: {\r\n      flex: 1,\r\n      marginTop: 40,\r\n      backgroundColor: '#fff',\r\n      alignItems: 'center',\r\n    },\r\n    cardStyle: {\r\n      marginTop: \"10%\",\r\n      position: 'absolute',\r\n      width: SCREEN_WIDTH,\r\n      borderRadius: 50,\r\n    },\r\n    imageStyle: {\r\n      height: IMAGE_HEIGHT,\r\n      width: SCREEN_WIDTH,\r\n    },\r\n    titleStyle: {\r\n      fontSize: 18\r\n    },\r\n    textStyle: {\r\n      marginBottom: 10,\r\n      fontSize: 16\r\n    },\r\n    buttonStyle: {\r\n      borderRadius: 50,\r\n      marginLeft: 0,\r\n      marginRight: 0,\r\n      marginBottom: 0,\r\n    },\r\n});\r\n\r\n\r\nexport {SwipeScreen};"]},"metadata":{},"sourceType":"module"}