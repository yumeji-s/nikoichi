{"ast":null,"code":"import _defineProperty from \"@babel/runtime/helpers/defineProperty\";\nimport _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) { symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); } keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport React, { useRef, useState, useEffect } from 'react';\nimport StyleSheet from \"react-native-web/dist/exports/StyleSheet\";\nimport Text from \"react-native-web/dist/exports/Text\";\nimport Animated from \"react-native-web/dist/exports/Animated\";\nimport Dimensions from \"react-native-web/dist/exports/Dimensions\";\nimport PanResponder from \"react-native-web/dist/exports/PanResponder\";\nimport LayoutAnimation from \"react-native-web/dist/exports/LayoutAnimation\";\nimport UIManager from \"react-native-web/dist/exports/UIManager\";\nimport Platform from \"react-native-web/dist/exports/Platform\";\nimport { Card, Button } from 'react-native-elements';\nimport { doc, setDoc } from 'firebase/firestore';\nimport { auth, firestore } from \"../../firebase\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nvar SCREEN_WIDTH = Dimensions.get('window').width;\nvar SCREEN_HEIGHT = Dimensions.get('window').height;\nvar SWIPE_THRESHOLD = 0.25 * SCREEN_WIDTH;\nvar SWIPE_OUT_DURATION = 250;\nvar IMAGE_HEIGHT = SCREEN_HEIGHT / 2;\n\nvar Deck = function Deck(_ref) {\n  var data = _ref.data;\n  UIManager.setLayoutAnimationEnabledExperimental && UIManager.setLayoutAnimationEnabledExperimental(true);\n  LayoutAnimation.spring();\n  var position = useRef(new Animated.ValueXY()).current;\n  var panResponder = useRef(PanResponder.create({\n    onStartShouldSetPanResponder: function onStartShouldSetPanResponder() {\n      return true;\n    },\n    onPanResponderMove: function onPanResponderMove(event, gesture) {\n      position.setValue({\n        x: gesture.dx,\n        y: gesture.dy\n      });\n    },\n    onPanResponderRelease: function onPanResponderRelease(event, gesture) {\n      if (gesture.dx > SWIPE_THRESHOLD) {\n        forceSwipe('right');\n      } else if (gesture.dx < -SWIPE_THRESHOLD) {\n        forceSwipe('left');\n      } else {\n        resetPosition();\n      }\n    }\n  })).current;\n\n  var forceSwipe = function forceSwipe(direction) {\n    var x = direction === 'right' ? SCREEN_WIDTH : -SCREEN_WIDTH;\n    Animated.timing(position, {\n      toValue: {\n        x: x,\n        y: 0\n      },\n      duration: SWIPE_OUT_DURATION,\n      useNativeDriver: false\n    }).start(function () {\n      return onSwipeComplete(direction);\n    });\n  };\n\n  var _useState = useState(0),\n      _useState2 = _slicedToArray(_useState, 2),\n      index = _useState2[0],\n      setIndex = _useState2[1];\n\n  var _useState3 = useState(''),\n      _useState4 = _slicedToArray(_useState3, 2),\n      swipeDirection = _useState4[0],\n      setSwipeDirection = _useState4[1];\n\n  useEffect(function () {\n    var partner = data[index - 1];\n\n    if (swipeDirection === 'right') {\n      onSwipeRight(partner);\n    } else if (swipeDirection === 'left') {\n      onSwipeLeft(partner);\n    }\n  }, [index]);\n\n  var onSwipeComplete = function onSwipeComplete(direction) {\n    position.setValue({\n      x: 0,\n      y: 0\n    });\n    setSwipeDirection(direction);\n    setIndex(function (prevIndex) {\n      return prevIndex + 1;\n    });\n  };\n\n  var resetPosition = function resetPosition() {\n    Animated.spring(position, {\n      toValue: {\n        x: 0,\n        y: 0\n      },\n      useNativeDriver: false\n    }).start();\n  };\n\n  var rotate = position.x.interpolate({\n    inputRange: [-SCREEN_WIDTH * 1.5, 0, SCREEN_WIDTH * 1.5],\n    outputRange: ['-120deg', '0deg', '120deg']\n  });\n\n  var onSwipeRight = function onSwipeRight(partner) {\n    var requestRef = doc(firestore, \"request/\" + partner.uid + \"/\" + partner.uid + \"/\" + auth.currentUser.uid);\n    setDoc(requestRef, {\n      request: true\n    }, {\n      capital: true\n    }, {\n      merge: true\n    });\n    var requestPartnerRef = doc(firestore, \"request/\" + auth.currentUser.uid + \"/\" + auth.currentUser.uid + \"/\" + partner.uid);\n    setDoc(requestPartnerRef, {\n      request: false\n    }, {\n      capital: true\n    }, {\n      merge: true\n    });\n  };\n\n  var onSwipeLeft = function onSwipeLeft(partner) {\n    console.log(\"dislike \" + partner.uid);\n  };\n\n  return _jsxs(_Fragment, {\n    children: [index >= data.length && _jsx(RenderNoMoreCards, {}), data.map(function (item, i) {\n      if (i < index) {\n        return null;\n      }\n\n      if (i === index) {\n        return _jsx(Animated.View, _objectSpread(_objectSpread({\n          style: [_objectSpread(_objectSpread({}, position.getLayout()), {}, {\n            transform: [{\n              rotate: rotate\n            }],\n            zIndex: 1,\n            elevation: Platform.OS === 'android' ? 50 : 0\n          }), styles.cardStyle]\n        }, panResponder.panHandlers), {}, {\n          children: _jsx(RenderCards, {\n            item: item\n          })\n        }), item.uid);\n      }\n\n      return _jsx(Animated.View, {\n        style: [styles.cardStyle, {\n          top: 10 * (i - index)\n        }],\n        children: _jsx(RenderCards, {\n          item: item\n        })\n      }, item.uid);\n    }).reverse()]\n  });\n};\n\nvar RenderCards = function RenderCards(_ref2) {\n  var item = _ref2.item;\n  return _jsxs(Card, {\n    children: [_jsx(Card.Title, {\n      style: styles.titleStyle,\n      children: item.name\n    }), _jsx(Card.Divider, {}), item.uri ? _jsx(Card.Image, {\n      source: {\n        uri: item.uri\n      },\n      style: styles.imageStyle,\n      resizeMode: \"contain\"\n    }) : _jsx(Card.Image, {\n      source: require(\"../../assets/defaultUserIcon.png\"),\n      style: styles.imageStyle,\n      resizeMode: \"stretch\"\n    }), _jsx(Card.Divider, {}), _jsx(Text, {\n      style: styles.textStyle,\n      children: item.introduction\n    }), _jsx(Button, {\n      buttonStyle: styles.buttonStyle,\n      title: \"\\u30D7\\u30ED\\u30D5\\u30A3\\u30FC\\u30EB\\u306F\\u3053\\u3061\\u3089\",\n      onPress: function onPress() {\n        console.info(\"name: \" + item.name);\n      }\n    })]\n  }, item.uid);\n};\n\nvar RenderNoMoreCards = function RenderNoMoreCards() {\n  return _jsxs(Card, {\n    style: styles.cardStyle,\n    children: [_jsx(Card.Title, {\n      style: styles.titleStyle,\n      children: \"\\u7D42\\u4E86\"\n    }), _jsx(Card.Divider, {}), _jsx(Text, {\n      style: styles.textStyle,\n      children: \"aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa\"\n    }), _jsx(Button, {\n      buttonStyle: styles.buttonStyle,\n      title: \"\\u3082\\u3046\\u4E00\\u5EA6\",\n      onPress: function onPress() {}\n    })]\n  });\n};\n\nvar styles = StyleSheet.create({\n  cardStyle: {\n    marginTop: \"10%\",\n    position: 'absolute',\n    width: SCREEN_WIDTH,\n    borderRadius: 50\n  },\n  imageStyle: {\n    height: IMAGE_HEIGHT,\n    width: SCREEN_WIDTH\n  },\n  titleStyle: {\n    fontSize: 18\n  },\n  textStyle: {\n    marginBottom: 10,\n    fontSize: 16\n  },\n  buttonStyle: {\n    borderRadius: 50,\n    marginLeft: 0,\n    marginRight: 0,\n    marginBottom: 0\n  }\n});\nexport { Deck };","map":{"version":3,"sources":["C:/Users/yumej/github/nikoichi/src/components/SwipeCard.js"],"names":["React","useRef","useState","useEffect","Card","Button","doc","setDoc","auth","firestore","SCREEN_WIDTH","Dimensions","get","width","SCREEN_HEIGHT","height","SWIPE_THRESHOLD","SWIPE_OUT_DURATION","IMAGE_HEIGHT","Deck","data","UIManager","setLayoutAnimationEnabledExperimental","LayoutAnimation","spring","position","Animated","ValueXY","current","panResponder","PanResponder","create","onStartShouldSetPanResponder","onPanResponderMove","event","gesture","setValue","x","dx","y","dy","onPanResponderRelease","forceSwipe","resetPosition","direction","timing","toValue","duration","useNativeDriver","start","onSwipeComplete","index","setIndex","swipeDirection","setSwipeDirection","partner","onSwipeRight","onSwipeLeft","prevIndex","rotate","interpolate","inputRange","outputRange","requestRef","uid","currentUser","request","capital","merge","requestPartnerRef","console","log","length","map","item","i","getLayout","transform","zIndex","elevation","Platform","OS","styles","cardStyle","panHandlers","top","reverse","RenderCards","titleStyle","name","uri","imageStyle","require","textStyle","introduction","buttonStyle","info","RenderNoMoreCards","StyleSheet","marginTop","borderRadius","fontSize","marginBottom","marginLeft","marginRight"],"mappings":"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","sourcesContent":["import React, { useRef, useState, useEffect } from 'react';\r\nimport {\r\n  StyleSheet,\r\n  Text,\r\n  Animated,\r\n  Dimensions,\r\n  PanResponder,\r\n  LayoutAnimation,\r\n  UIManager,\r\n  Platform,\r\n} from 'react-native';\r\nimport { Card, Button } from 'react-native-elements';\r\nimport { doc, setDoc } from 'firebase/firestore';\r\n\r\nimport { auth, firestore } from '../../firebase';\r\n\r\nconst SCREEN_WIDTH = Dimensions.get('window').width;\r\nconst SCREEN_HEIGHT = Dimensions.get('window').height;\r\nconst SWIPE_THRESHOLD = 0.25 * SCREEN_WIDTH;\r\nconst SWIPE_OUT_DURATION = 250;\r\nconst IMAGE_HEIGHT = SCREEN_HEIGHT / 2;\r\n\r\nconst Deck = ({ data }) => {\r\n    UIManager.setLayoutAnimationEnabledExperimental &&\r\n      UIManager.setLayoutAnimationEnabledExperimental(true);\r\n    LayoutAnimation.spring();\r\n  \r\n    const position = useRef(new Animated.ValueXY()).current;\r\n    const panResponder = useRef(\r\n      PanResponder.create({\r\n        onStartShouldSetPanResponder: () => true,\r\n        onPanResponderMove: (event, gesture) => {\r\n          position.setValue({ x: gesture.dx, y: gesture.dy });\r\n        },\r\n        onPanResponderRelease: (event, gesture) => {\r\n          if (gesture.dx > SWIPE_THRESHOLD) {\r\n            forceSwipe('right');\r\n          } else if (gesture.dx < -SWIPE_THRESHOLD) {\r\n            forceSwipe('left');\r\n          } else {\r\n            resetPosition();\r\n          }\r\n        },\r\n      })\r\n    ).current;\r\n  \r\n    const forceSwipe = (direction) => {\r\n      const x = direction === 'right' ? SCREEN_WIDTH : -SCREEN_WIDTH;\r\n      Animated.timing(position, {\r\n        toValue: { x, y: 0 },\r\n        duration: SWIPE_OUT_DURATION,\r\n        useNativeDriver: false,\r\n      }).start(() => onSwipeComplete(direction));\r\n    };\r\n    \r\n    const [index, setIndex] = useState(0);\r\n    const [swipeDirection, setSwipeDirection] = useState('');\r\n    \r\n    useEffect(() => {\r\n      const partner = data[index - 1];\r\n      if(swipeDirection === 'right'){\r\n        onSwipeRight(partner);\r\n      }else if(swipeDirection === 'left'){\r\n        onSwipeLeft(partner);\r\n      }\r\n    },[index]);\r\n  \r\n    const onSwipeComplete = (direction) => {\r\n      position.setValue({ x: 0, y: 0 });\r\n      setSwipeDirection(direction);\r\n      setIndex(prevIndex => prevIndex + 1);\r\n    };\r\n  \r\n    const resetPosition = () => {\r\n      Animated.spring(position, {\r\n        toValue: { x: 0, y: 0 },\r\n        useNativeDriver: false,\r\n      }).start();\r\n    };\r\n  \r\n    const rotate = position.x.interpolate({\r\n      inputRange: [-SCREEN_WIDTH * 1.5, 0, SCREEN_WIDTH * 1.5],\r\n      outputRange: ['-120deg', '0deg', '120deg'],\r\n    });\r\n  \r\n  \r\n    const onSwipeRight = (partner) => {\r\n      const requestRef = doc(firestore, `request/${partner.uid}/${partner.uid}/${auth.currentUser.uid}`);\r\n      setDoc(requestRef, {\r\n        request : true,\r\n      },{ capital: true }, { merge: true });\r\n      const requestPartnerRef = doc(firestore, `request/${auth.currentUser.uid}/${auth.currentUser.uid}/${partner.uid}`);\r\n      setDoc(requestPartnerRef, {\r\n        request : false,\r\n      },{ capital: true }, { merge: true });\r\n    };\r\n  \r\n    const onSwipeLeft = (partner) => {\r\n      console.log(\"dislike \" + partner.uid);\r\n      // 嫌いの時\r\n    };\r\n  \r\n    return (\r\n      <>\r\n        {index >= data.length && <RenderNoMoreCards />}\r\n        {data\r\n          .map((item, i) => {\r\n            if (i < index) {\r\n              return null;\r\n            }\r\n  \r\n            if (i === index) {\r\n              return (\r\n                <Animated.View\r\n                  key={item.uid}\r\n                  style={[\r\n                    {\r\n                      ...position.getLayout(),\r\n                      transform: [{ rotate }],\r\n                      zIndex: 1,\r\n                      elevation: (Platform.OS === 'android') ? 50 : 0\r\n                    },\r\n                    styles.cardStyle,\r\n                  ]}\r\n                  {...panResponder.panHandlers}\r\n                >\r\n                  <RenderCards item={item} />\r\n                </Animated.View>\r\n              );\r\n            }\r\n  \r\n            return (\r\n              <Animated.View\r\n                key={item.uid}\r\n                style={[styles.cardStyle, { top: 10 * (i - index) }]}\r\n              >\r\n                <RenderCards item={item} />\r\n              </Animated.View>\r\n            );\r\n          })\r\n          .reverse()}\r\n      </>\r\n    );\r\n  };\r\n  \r\n  const RenderCards = ({ item }) => {\r\n    return (\r\n      <Card key={item.uid}>\r\n        <Card.Title style={styles.titleStyle}>{item.name}</Card.Title>\r\n        <Card.Divider />\r\n          {\r\n            item.uri ? \r\n              <Card.Image source={{ uri: item.uri }} style={styles.imageStyle} resizeMode='contain'/> :\r\n              <Card.Image source={require('../../assets/defaultUserIcon.png')} style={styles.imageStyle} resizeMode='stretch'/>\r\n          }\r\n        <Card.Divider />\r\n        <Text style={styles.textStyle}>{item.introduction}</Text>\r\n        <Button buttonStyle={styles.buttonStyle} title=\"プロフィールはこちら\" onPress={() => {console.info(`name: ${item.name}`)}} />\r\n      </Card>\r\n    );\r\n  };\r\n  \r\n  const RenderNoMoreCards = () => {\r\n    return (\r\n      <Card style={styles.cardStyle}>\r\n        <Card.Title style={styles.titleStyle}>終了</Card.Title>\r\n        <Card.Divider />\r\n        <Text style={styles.textStyle}>aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa</Text>\r\n        <Button buttonStyle={styles.buttonStyle} title=\"もう一度\" onPress={() => {}}/>\r\n      </Card>\r\n    );\r\n  };\r\n  \r\n\r\n  const styles = StyleSheet.create({\r\n    cardStyle: {\r\n      marginTop: \"10%\",\r\n      position: 'absolute',\r\n      width: SCREEN_WIDTH,\r\n      borderRadius: 50,\r\n    },\r\n    imageStyle: {\r\n      height: IMAGE_HEIGHT,\r\n      width: SCREEN_WIDTH,\r\n    },\r\n    titleStyle: {\r\n      fontSize: 18\r\n    },\r\n    textStyle: {\r\n      marginBottom: 10,\r\n      fontSize: 16\r\n    },\r\n    buttonStyle: {\r\n      borderRadius: 50,\r\n      marginLeft: 0,\r\n      marginRight: 0,\r\n      marginBottom: 0,\r\n    },\r\n});\r\n\r\n\r\nexport { Deck };"]},"metadata":{},"sourceType":"module"}