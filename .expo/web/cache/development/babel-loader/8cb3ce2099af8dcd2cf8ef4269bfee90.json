{"ast":null,"code":"import _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport React, { useState, useCallback, useEffect } from 'react';\nimport View from \"react-native-web/dist/exports/View\";\nimport Text from \"react-native-web/dist/exports/Text\";\nimport StyleSheet from \"react-native-web/dist/exports/StyleSheet\";\nimport Image from \"react-native-web/dist/exports/Image\";\nimport { Avatar } from 'react-native-elements';\nimport { Button, NativeBaseProvider, ScrollView } from 'native-base';\nimport { useNavigation } from '@react-navigation/native';\nimport Constants from 'expo-constants';\nimport * as ImagePicker from 'expo-image-picker';\nimport * as Permissions from 'expo-permissions';\nimport { signOut } from 'firebase/auth';\nimport { doc, setDoc, getDoc, updateDoc } from 'firebase/firestore';\nimport { ref, uploadBytes, getDownloadURL } from 'firebase/storage';\nimport { auth, firestore, storage } from \"../../firebase\";\nimport { LoadingScreen } from \"./LoadingScreen\";\nimport { ProfileList } from \"../components/ProfileList\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\n\nvar ProfileScreen = function ProfileScreen() {\n  var navigation = useNavigation();\n\n  var _useState = useState(),\n      _useState2 = _slicedToArray(_useState, 2),\n      user = _useState2[0],\n      setUser = _useState2[1];\n\n  var _useState3 = useState(null),\n      _useState4 = _slicedToArray(_useState3, 2),\n      icon = _useState4[0],\n      setIcon = _useState4[1];\n\n  var _useState5 = useState(null),\n      _useState6 = _slicedToArray(_useState5, 2),\n      iconUpdateAt = _useState6[0],\n      setIconUpdateAt = _useState6[1];\n\n  var _useState7 = useState(true),\n      _useState8 = _slicedToArray(_useState7, 2),\n      loading = _useState8[0],\n      setLoading = _useState8[1];\n\n  useEffect(function _callee() {\n    var userRef, snapShot;\n    return _regeneratorRuntime.async(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            userRef = doc(firestore, \"users/\" + auth.currentUser.uid);\n            _context.next = 3;\n            return _regeneratorRuntime.awrap(getDoc(userRef));\n\n          case 3:\n            snapShot = _context.sent;\n\n            if (snapShot.data().imgURL != '') {\n              setIcon(snapShot.data().imgURL);\n              setIconUpdateAt(snapShot.data().updateAt);\n            }\n\n            setUser({\n              name: snapShot.data().name,\n              imgURL: snapShot.data().imgURL\n            });\n            setLoading(false);\n\n          case 7:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, null, null, null, Promise);\n  }, []);\n\n  var handleLogout = function handleLogout() {\n    signOut(auth).then(function () {\n      console.log('logout');\n    }).catch(function (error) {\n      console.log(error.message);\n    });\n  };\n\n  var pickImage = function pickImage() {\n    var update, _await$Permissions$as, status, result;\n\n    return _regeneratorRuntime.async(function pickImage$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            update = (new Date() - iconUpdateAt) / (1000 * 60) < 5;\n\n            if (!update) {\n              _context2.next = 3;\n              break;\n            }\n\n            return _context2.abrupt(\"return\");\n\n          case 3:\n            if (!Constants.platform.ios) {\n              _context2.next = 11;\n              break;\n            }\n\n            _context2.next = 6;\n            return _regeneratorRuntime.awrap(Permissions.askAsync(Permissions.CAMERA));\n\n          case 6:\n            _await$Permissions$as = _context2.sent;\n            status = _await$Permissions$as.status;\n\n            if (!(status !== 'granted')) {\n              _context2.next = 11;\n              break;\n            }\n\n            alert(\"利用には許可が必要です。\");\n            return _context2.abrupt(\"return\");\n\n          case 11:\n            _context2.next = 13;\n            return _regeneratorRuntime.awrap(ImagePicker.launchImageLibraryAsync({\n              mediaTypes: ImagePicker.MediaTypeOptions.Images,\n              quality: 1\n            }));\n\n          case 13:\n            result = _context2.sent;\n\n            if (!result.cancelled) {\n              updateIcon(result.uri);\n            }\n\n          case 15:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, null, null, null, Promise);\n  };\n\n  var updateIcon = function updateIcon(url) {\n    var iconRef, localUri, localBlob, metadata;\n    return _regeneratorRuntime.async(function updateIcon$(_context4) {\n      while (1) {\n        switch (_context4.prev = _context4.next) {\n          case 0:\n            iconRef = ref(storage, \"images/\" + auth.currentUser.uid + \"/icon\");\n            _context4.next = 3;\n            return _regeneratorRuntime.awrap(fetch(url));\n\n          case 3:\n            localUri = _context4.sent;\n            _context4.next = 6;\n            return _regeneratorRuntime.awrap(localUri.blob());\n\n          case 6:\n            localBlob = _context4.sent;\n            metadata = {\n              name: 'icon'\n            };\n            uploadBytes(iconRef, localBlob, metadata).then(function _callee2(snapshot) {\n              var userIconRef, imgUrl;\n              return _regeneratorRuntime.async(function _callee2$(_context3) {\n                while (1) {\n                  switch (_context3.prev = _context3.next) {\n                    case 0:\n                      userIconRef = doc(firestore, \"users/\" + auth.currentUser.uid);\n                      _context3.next = 3;\n                      return _regeneratorRuntime.awrap(getDownloadURL(ref(storage, \"images/\" + auth.currentUser.uid + \"/icon\")));\n\n                    case 3:\n                      imgUrl = _context3.sent;\n                      updateDoc(userIconRef, {\n                        imgURL: imgUrl,\n                        updateAt: new Date()\n                      }, {\n                        capital: true\n                      });\n                      setIconUpdateAt(new Date());\n                      setIcon(url);\n\n                    case 7:\n                    case \"end\":\n                      return _context3.stop();\n                  }\n                }\n              }, null, null, null, Promise);\n            });\n\n          case 9:\n          case \"end\":\n            return _context4.stop();\n        }\n      }\n    }, null, null, null, Promise);\n  };\n\n  if (loading) {\n    return _jsx(LoadingScreen, {});\n  }\n\n  return _jsx(NativeBaseProvider, {\n    children: _jsx(View, {\n      style: styles.root,\n      children: _jsxs(ScrollView, {\n        h: \"80\",\n        _contentContainerStyle: {\n          px: \"20px\",\n          mb: \"4\",\n          minW: \"72\"\n        },\n        children: [_jsxs(View, {\n          style: styles.actionBar,\n          children: [_jsx(Text, {\n            children: user.name\n          }), _jsx(Button, {\n            style: styles.button,\n            onPress: handleLogout,\n            children: \"\\u30ED\\u30B0\\u30A2\\u30A6\\u30C8\"\n          })]\n        }), _jsxs(View, {\n          alignSelf: \"center\",\n          children: [icon && _jsx(Avatar, {\n            rounded: true,\n            size: \"xlarge\",\n            source: {\n              uri: icon\n            },\n            activeOpacity: 0.7,\n            onPress: pickImage,\n            children: _jsx(Avatar.Accessory, {\n              size: 50,\n              onPress: pickImage\n            })\n          }, icon), !icon && _jsx(Avatar, {\n            rounded: true,\n            size: \"xlarge\",\n            icon: {\n              name: 'user',\n              color: 'white',\n              type: 'font-awesome'\n            },\n            containerStyle: {\n              backgroundColor: \"gray\"\n            },\n            activeOpacity: 0.7,\n            onPress: pickImage,\n            children: _jsx(Avatar.Accessory, {\n              size: 50,\n              onPress: pickImage\n            })\n          }, icon)]\n        }), _jsx(ProfileList, {})]\n      })\n    })\n  });\n};\n\nvar styles = StyleSheet.create({\n  root: {\n    flex: 1,\n    display: 'flex',\n    alignContent: 'center'\n  },\n  actionBar: {\n    display: 'flex',\n    flexDirection: 'row',\n    justifyContent: 'flex-end',\n    padding: 12\n  },\n  button: {\n    display: 'flex',\n    justifyContent: 'center',\n    alignItems: 'center',\n    width: 120,\n    padding: 12,\n    borderRadius: 50,\n    backgroundColor: 'rgb(29, 161, 242)'\n  },\n  tweetButtonText: {\n    color: '#ffffff'\n  },\n  input: {\n    height: 400,\n    backgroundColor: '#f8f8f8',\n    padding: 12\n  }\n});\nexport { ProfileScreen };","map":{"version":3,"sources":["C:/Users/yumej/github/nikoichi/src/screens/ProfileScreen.js"],"names":["React","useState","useCallback","useEffect","Avatar","Button","NativeBaseProvider","ScrollView","useNavigation","Constants","ImagePicker","Permissions","signOut","doc","setDoc","getDoc","updateDoc","ref","uploadBytes","getDownloadURL","auth","firestore","storage","LoadingScreen","ProfileList","ProfileScreen","navigation","user","setUser","icon","setIcon","iconUpdateAt","setIconUpdateAt","loading","setLoading","userRef","currentUser","uid","snapShot","data","imgURL","updateAt","name","handleLogout","then","console","log","catch","error","message","pickImage","update","Date","platform","ios","askAsync","CAMERA","status","alert","launchImageLibraryAsync","mediaTypes","MediaTypeOptions","Images","quality","result","cancelled","updateIcon","uri","url","iconRef","fetch","localUri","blob","localBlob","metadata","snapshot","userIconRef","imgUrl","capital","styles","root","px","mb","minW","actionBar","button","color","type","backgroundColor","StyleSheet","create","flex","display","alignContent","flexDirection","justifyContent","padding","alignItems","width","borderRadius","tweetButtonText","input","height"],"mappings":"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","sourcesContent":["import React, { useState, useCallback, useEffect } from 'react';\r\nimport { View, Text, StyleSheet, Image } from 'react-native';\r\nimport { Avatar } from 'react-native-elements';\r\nimport { Button, NativeBaseProvider, ScrollView } from 'native-base'; \r\nimport { useNavigation } from '@react-navigation/native';\r\nimport Constants from 'expo-constants';\r\nimport * as ImagePicker from 'expo-image-picker';\r\nimport * as Permissions from 'expo-permissions';\r\nimport { signOut } from 'firebase/auth';\r\nimport { doc, setDoc, getDoc, updateDoc } from 'firebase/firestore';\r\nimport { ref, uploadBytes, getDownloadURL } from 'firebase/storage';\r\n\r\nimport { auth, firestore, storage } from '../../firebase';\r\nimport { LoadingScreen } from './LoadingScreen';\r\nimport { ProfileList } from '../components/ProfileList';\r\n\r\nconst ProfileScreen = () => {\r\n  \r\n  const navigation = useNavigation();\r\n  const [user, setUser] = useState();\r\n  const [icon, setIcon] = useState(null);\r\n  const [iconUpdateAt, setIconUpdateAt] = useState(null);\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  useEffect(async () => {\r\n    // 最初のレンダリング時にアイコンなどを取得\r\n    const userRef = doc(firestore, `users/${auth.currentUser.uid}`);\r\n    const snapShot = await getDoc(userRef);\r\n    if(snapShot.data().imgURL != ''){\r\n      setIcon(snapShot.data().imgURL);\r\n      setIconUpdateAt(snapShot.data().updateAt);\r\n    }\r\n    setUser({\r\n      name: snapShot.data().name,\r\n      imgURL: snapShot.data().imgURL,\r\n    });\r\n    setLoading(false);\r\n  },[]);\r\n\r\n  const handleLogout = () => {\r\n    signOut(auth)\r\n      .then(() => {\r\n        console.log('logout');\r\n      })\r\n      .catch((error) => {\r\n        console.log(error.message);\r\n      });\r\n  };\r\n\r\n  const pickImage = async () => {\r\n\r\n    // アイコンが更新されたら五分間更新できないようにする\r\n    const update = (new Date() - iconUpdateAt) / (1000 * 60) < 5;\r\n    if(update){\r\n      return;\r\n    }\r\n\r\n    if (Constants.platform.ios) {\r\n      const { status } = await Permissions.askAsync(Permissions.CAMERA);\r\n      if (status !== 'granted') {\r\n          alert(\"利用には許可が必要です。\");\r\n          return;\r\n      }\r\n    }\r\n    let result = await ImagePicker.launchImageLibraryAsync({\r\n      mediaTypes: ImagePicker.MediaTypeOptions.Images,\r\n      // allowsEditing: true,\r\n      // aspect: [4, 3],\r\n      quality: 1,\r\n    });\r\n\r\n    if (!result.cancelled) {\r\n      updateIcon(result.uri);\r\n    }\r\n  };\r\n\r\n  const updateIcon = async (url) => {\r\n    const iconRef = ref(storage, `images/${auth.currentUser.uid}/icon`);\r\n    const localUri = await fetch(url);\r\n    const localBlob = await localUri.blob();\r\n\r\n    const metadata = {\r\n      name : 'icon',\r\n    };\r\n\r\n    uploadBytes(iconRef, localBlob, metadata).then(async (snapshot) => {\r\n      const userIconRef = doc(firestore, `users/${auth.currentUser.uid}`);\r\n      const imgUrl = await getDownloadURL(ref(storage, `images/${auth.currentUser.uid}/icon`));\r\n      updateDoc(userIconRef, {\r\n        imgURL : imgUrl,\r\n        updateAt : new Date(),\r\n      }, { capital: true });\r\n      setIconUpdateAt(new Date());\r\n      setIcon(url);\r\n    });\r\n  };\r\n\r\n  if(loading){\r\n    return <LoadingScreen />;\r\n  }\r\n\r\n  return (\r\n    <NativeBaseProvider>\r\n      <View style={styles.root}>\r\n        <ScrollView h=\"80\" _contentContainerStyle={{\r\n          px: \"20px\",\r\n          mb: \"4\",\r\n          minW: \"72\"\r\n        }}>\r\n          <View style={styles.actionBar}>\r\n            <Text>{user.name}</Text>\r\n            <Button style={styles.button} onPress={handleLogout}>ログアウト</Button>\r\n          </View>\r\n          <View alignSelf=\"center\">\r\n            {icon && <Avatar rounded size=\"xlarge\" source={{uri: icon}} activeOpacity={0.7} key={icon} onPress={pickImage}>\r\n              <Avatar.Accessory size={50} onPress={pickImage} />\r\n            </Avatar>}\r\n            {!icon && <Avatar rounded size=\"xlarge\" icon={{name: 'user', color: 'white', type: 'font-awesome'}}\r\n                containerStyle={{backgroundColor: \"gray\"}} activeOpacity={0.7} key={icon} onPress={pickImage}>\r\n              <Avatar.Accessory size={50} onPress={pickImage} />\r\n            </Avatar>}\r\n          </View>\r\n          <ProfileList />\r\n        </ScrollView>\r\n      </View>\r\n    </NativeBaseProvider>\r\n  );\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  root: {\r\n    flex: 1,\r\n    display: 'flex',\r\n    alignContent: 'center',\r\n  },\r\n  actionBar: {\r\n    display: 'flex',\r\n    flexDirection: 'row',\r\n    justifyContent: 'flex-end',\r\n    padding: 12,\r\n  },\r\n  button: {\r\n    display: 'flex',\r\n    justifyContent: 'center',\r\n    alignItems: 'center',\r\n    width: 120,\r\n    padding: 12,\r\n    borderRadius: 50,\r\n    backgroundColor: 'rgb(29, 161, 242)',\r\n  },\r\n  tweetButtonText: {\r\n    color: '#ffffff',\r\n  },\r\n  input: {\r\n    height: 400,\r\n    backgroundColor: '#f8f8f8',\r\n    padding: 12,\r\n  },\r\n})\r\n\r\nexport {ProfileScreen};\r\n"]},"metadata":{},"sourceType":"module"}